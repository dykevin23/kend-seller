# growth-chart-guide.md

## Notes for AI Assistants

- 이 문서는 질병관리본부 & 대한소아과학회 발행 "2017 소아청소년 성장도표 이용지침서"의 핵심 내용을 정리한 것이다.
- 원본 파일: `/references/page1.png` ~ `/references/page15.png`
- Kend 앱의 "성장기록" 기능 구현 시 본 문서를 기준으로 백분위수 계산, 그래프 표시 등을 설계한다.

---

## 1. 성장도표 개요

- 2017 소아청소년 성장도표는 질병관리본부와 대한소아과학회가 공동 개발했다.
- 2007 성장도표를 개정한 것으로, WHO Growth Standards를 반영한다.
- 소아청소년의 성장, 체중 등 신체계측을 평가하는 기준으로 활용된다.

---

## 2. 성장도표 구성

### 2.1 분류

| 구분      | WHO Growth Standards | 2017 성장도표 |
| --------- | -------------------- | ------------- |
| 연령 범위 | 0~35개월             | 2~18세        |
| 신장(키)  | 누운키(신장)         | 선키(신장)    |

### 2.2 성장도표 종류

- **연령별 신장** (Height/Length-for-age)
- **연령별 체중** (Weight-for-age)
- **연령별 체질량지수(BMI)** (BMI-for-age)
- **연령별 머리둘레** (Head circumference-for-age) - 0~35개월만
- **신장별 체중** (Weight-for-height/length)

### 2.3 백분위수 곡선

성장도표에 표시되는 백분위 곡선:

- 3rd, 5th, 10th, 15th, 25th, **50th**, 75th, 85th, 90th, 95th, 97th

---

## 3. 신체계측 기준

### 3.1 신장 측정

- **2세 미만**: 누운 자세로 눈금자(신장계)를 이용해 측정 → cm 단위, 소수점 한자리까지
- **2~18세**: 선 자세로 신장계를 이용해 측정 → cm 단위, 소수점 한자리까지
- 2세 미만의 눈금자 측정값과 2세 이상의 신장계 측정값은 약 0.7cm 차이가 있으므로, 측정값의 차이를 보정해야 한다.

### 3.2 체중 측정

- kg 단위, 소수점 한자리까지
- 영유아용 체중계 또는 일반 체중계 사용

### 3.3 머리둘레 측정

- cm 단위, 소수점 한자리까지
- 줄자를 이용해 눈썹위/귀위/뒷통수 가장 튀어나온 부분을 감싸서 측정

---

## 4. 연령 계산

### 공식

```
연령(개월) = (측정연도 - 출생연도) × 12 + (측정월 - 출생월) + (측정일 - 출생일) / 30.5
```

### 예시

- 생년월일: 2015년 11월 10일
- 측정일: 2017년 12월 12일

```
(2017 - 2015) × 12 + (12 - 11) + (12 - 10) / 30.6
= 24 + 1 + 0.1
= 25.1개월
→ 반올림하여 25개월로 사용
```

> 연령 계산 시 소수점 이하는 **반올림**하여 정수 개월로 사용한다.

---

## 5. 체질량지수(BMI) 계산

### 공식

```
BMI(kg/m²) = 체중(kg) / 신장(m)² × 10,000
```

### 예시

- 신장: 154.0cm, 체중: 52.3kg

```
52.3 / 154.0² × 10,000 = 22.1 (kg/m²)
```

---

## 6. 백분위수 확인 방법

### 6.1 성장곡선을 이용한 확인 (그래프)

- X축: 연령(개월 또는 세)
- Y축: 신장(cm) / 체중(kg) / BMI(kg/m²)
- 아이의 측정값을 그래프 위에 점으로 찍어 가장 가까운 백분위 곡선을 확인한다.

### 6.2 성장도표(테이블)을 이용한 확인

- 성장도표 테이블에서 연령 행을 찾고, 측정값이 어떤 백분위 열 사이에 위치하는지 확인한다.

### 6.3 공식을 이용한 정확한 백분위수 계산 (핵심)

해당 연령/성별의 **L, M, S 값**을 사용하여 Z-score를 구한 뒤 백분위수를 산출한다.

#### L, M, S 파라미터

- **L** (Lambda): Box-Cox 변환 지수 (왜도 보정)
- **M** (Mu): 중앙값 (해당 연령의 50 백분위수 값)
- **S** (Sigma): 변이계수 (변동성)

> L, M, S 값은 성장도표 데이터테이블(엑셀)에 연령/성별별로 제공된다.
> 질병관리본부 홈페이지(www.cdc.go.kr)에서 다운로드 가능하다.

#### Z-score(표준점수) 계산 공식

```
L ≠ 0일 때:  Z = ((x / M)^L - 1) / (L × S)
L = 0일 때:  Z = ln(x / M) / S
```

- **x**: 신체계측치 (신장, 체중, BMI 등)
- **Z**: 표준점수 (z-score)

#### 백분위수 산출

```
백분위수 = NORMSDIST(Z) × 100
```

- NORMSDIST는 표준정규분포의 누적분포함수(CDF)이다.
- JavaScript에서는 직접 구현하거나 라이브러리를 사용해야 한다.

#### 계산 예시

**조건:**

- 성별: 남
- 연령: 147개월 (12세 3개월)
- 신장: 154.0cm

**해당 연령의 L, M, S 값:**

| 연령(개월) | L      | M        | S      |
| ---------- | ------ | -------- | ------ |
| 147        | 1.1829 | 153.2358 | 0.0468 |

**Z-score 계산:**

```
Z = ((154.0 / 153.2358)^1.1829 - 1) / (1.1829 × 0.0468)
  = ((1.00499)^1.1829 - 1) / 0.05536
  = 0.1066
```

**백분위수 산출:**

```
백분위수 = NORMSDIST(0.1066) × 100 = 54.2
→ 이 아이의 신장은 같은 연령 남아 중 약 54.2 백분위수
→ 100명 중 앞에서 약 46번째, 뒤에서 약 54번째
```

---

## 7. 성장도표 선별 기준

### 연령별 사용 기준

| 대상       | 성장도표 기준                      |
| ---------- | ---------------------------------- |
| 0~2세 미만 | WHO Growth Standards 사용          |
| 2~18세     | 2017 한국 소아청소년 성장도표 사용 |

### 지표별 사용 기준

| 지표   | 0~2세 미만      | 2~18세            |
| ------ | --------------- | ----------------- |
| 저신장 | 연령별 신장     | 연령별 신장       |
| 저체중 | 연령별 체중     | 연령별 체중       |
| 소모증 | 신장별 체중     | 연령별 체질량지수 |
| 과체중 | 신장별 체중     | 연령별 체질량지수 |
| 소두증 | 연령별 머리둘레 | -                 |

### 비만 판정 기준

- 체질량지수가 **25kg/m²** 이상이거나 성장도표 **85 백분위수 이상**이면 과체중/비만으로 판정
- 소아비만은 체질량지수 **95 백분위수 이상** 또는 성인 기준 BMI 25 이상

---

## 8. 성장도표 활용 시 유의사항

- 2017 성장도표는 한국 소아청소년에 최적화된 기준이다.
- 0~2세 미만은 WHO Growth Standards를 사용하며, 이는 모유수유아 기준의 국제 표준이다.
- 14세 이후의 성장도표는 WHO Growth Standards를 반영하되, 한국 데이터와 접합(smoothing)하여 만들어졌다.
- 단일 시점 측정보다 **추세(시간에 따른 변화)**가 더 중요하다. 반복 측정을 통해 성장 패턴을 확인해야 한다.
- 백분위수가 3 미만이거나 97 초과이면 전문의 상담을 권장한다.

---

## 9. Kend 앱 구현 시 필요사항

### 입력 데이터

- 성별 (남/여)
- 생년월일
- 측정일
- 신장 (cm, 소수점 1자리)
- 체중 (kg, 소수점 1자리)

### 참조 데이터 (엑셀에서 가져올 것)

- 연령(개월)별 L, M, S 값
  - 남아 신장, 여아 신장
  - 남아 체중, 여아 체중
  - 남아 BMI, 여아 BMI
  - (선택) 남아 머리둘레, 여아 머리둘레

### 계산 로직

1. 생년월일과 측정일로 연령(개월) 계산 → 반올림
2. 연령/성별에 해당하는 L, M, S 값 조회
3. Z-score 계산: `Z = ((x/M)^L - 1) / (L × S)`
4. 백분위수 산출: `NORMSDIST(Z) × 100`
5. BMI 계산: `체중 / (신장/100)²`
6. BMI에 대해서도 동일하게 백분위수 산출

### 그래프 표시

- X축: 연령(개월), Y축: 신장/체중/BMI
- 백분위 곡선(3rd, 10th, 25th, 50th, 75th, 90th, 97th) 표시
- 아이의 측정 데이터를 점으로 표시
- 여러 시점의 데이터가 있으면 선으로 연결하여 성장 추세 표시

### JavaScript NORMSDIST 구현

```typescript
/**
 * 표준정규분포 누적분포함수 (CDF)
 * Excel의 NORMSDIST()와 동일한 결과를 반환한다.
 */
function normsdist(z: number): number {
  const a1 = 0.254829592;
  const a2 = -0.284496736;
  const a3 = 1.421413741;
  const a4 = -1.453152027;
  const a5 = 1.061405429;
  const p = 0.3275911;

  const sign = z < 0 ? -1 : 1;
  const x = Math.abs(z) / Math.sqrt(2);
  const t = 1.0 / (1.0 + p * x);
  const y =
    1.0 - ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);

  return 0.5 * (1.0 + sign * y);
}

/**
 * 백분위수 계산
 * @param x - 측정값 (신장, 체중, BMI)
 * @param L - Box-Cox 변환 지수
 * @param M - 중앙값
 * @param S - 변이계수
 * @returns 백분위수 (0~100)
 */
function calculatePercentile(
  x: number,
  L: number,
  M: number,
  S: number,
): number {
  let z: number;
  if (L !== 0) {
    z = (Math.pow(x / M, L) - 1) / (L * S);
  } else {
    z = Math.log(x / M) / S;
  }
  return normsdist(z) * 100;
}
```

---

## 10. CSV 데이터 파일 구조

### 10.1 파일 목록

| 파일명                      | 용도                 | 연령/신장 범위      |
| --------------------------- | -------------------- | ------------------- |
| `연령별성장.csv`            | 연령별 신장          | 0~228개월 (0~19세)  |
| `연령별체중.csv`            | 연령별 체중          | 0~228개월 (0~19세)  |
| `연령별머리둘레.csv`        | 연령별 머리둘레      | 0~72개월 (0~6세)    |
| `연령별체질량지수.csv`      | 연령별 BMI           | 24~228개월 (2~19세) |
| `신장별체중(2세미만).csv`   | 신장별 체중 (누운키) | 45~110cm            |
| `신장별체중(2-3세미만).csv` | 신장별 체중 (선키)   | 65~120cm            |
| `신장별체중(3세이상).csv`   | 신장별 체중 (선키)   | 65~145cm            |

### 10.2 공통 컬럼 구조

#### 연령별 파일 (연령별성장, 연령별체중, 연령별머리둘레, 연령별체질량지수)

| 컬럼명          | 설명                         | 값 예시           |
| --------------- | ---------------------------- | ----------------- |
| `성별`          | 1=남, 2=여                   | 1 또는 2          |
| `만나이(세)`    | 만 나이 (년)                 | 0, 1, 2, ...      |
| `만나이(개월)`  | 만 나이 (개월) - **조회 키** | 0, 1, 2, ..., 228 |
| `L`             | Box-Cox 변환 지수            | 1.1829            |
| `M`             | 중앙값 (50 백분위)           | 153.2358          |
| `S`             | 변이계수                     | 0.0468            |
| `1st` ~ `99th`  | 각 백분위수 값               | 그래프 곡선용     |
| `-3SD` ~ `+3SD` | 표준편차 기반 값             | 참고용            |

#### 신장별 파일 (신장별체중)

| 컬럼명         | 설명                         | 비고            |
| -------------- | ---------------------------- | --------------- |
| `성별`         | 1=남, 2=여                   |                 |
| `누운키(cm)`   | 누운 자세 신장 - **조회 키** | 2세 미만 파일만 |
| `선키(cm)`     | 선 자세 신장 - **조회 키**   | 2세 이상 파일만 |
| `L`, `M`, `S`  | LMS 파라미터                 | 동일            |
| `1st` ~ `99th` | 각 백분위수 값               |                 |

### 10.3 성별 코드

```
1 = 남아 (Male)
2 = 여아 (Female)
```

### 10.4 데이터 조회 로직

```typescript
// 연령별 데이터 조회 예시
function getLMSByAge(
  data: GrowthData[],
  gender: 1 | 2,
  ageInMonths: number,
): { L: number; M: number; S: number } | null {
  const row = data.find(
    (d) => d.성별 === gender && d["만나이(개월)"] === ageInMonths,
  );
  return row ? { L: row.L, M: row.M, S: row.S } : null;
}

// 신장별 체중 데이터 조회 예시 (2세 미만)
function getLMSByLength(
  data: WeightForLengthData[],
  gender: 1 | 2,
  lengthCm: number,
): { L: number; M: number; S: number } | null {
  const row = data.find(
    (d) => d.성별 === gender && d["누운키(cm)"] === lengthCm,
  );
  return row ? { L: row.L, M: row.M, S: row.S } : null;
}
```

### 10.5 파일별 사용 시점

| 연령           | 신장 평가  | 체중 평가                          | BMI 평가         | 머리둘레       |
| -------------- | ---------- | ---------------------------------- | ---------------- | -------------- |
| 0~24개월 미만  | 연령별성장 | 연령별체중 + 신장별체중(2세미만)   | -                | 연령별머리둘레 |
| 24~36개월 미만 | 연령별성장 | 연령별체중 + 신장별체중(2-3세미만) | 연령별체질량지수 | 연령별머리둘레 |
| 36~72개월      | 연령별성장 | 연령별체중 + 신장별체중(3세이상)   | 연령별체질량지수 | 연령별머리둘레 |
| 72개월 이상    | 연령별성장 | 연령별체중                         | 연령별체질량지수 | -              |

### 10.6 신장 측정 방식 주의사항

- **누운키 (Recumbent length)**: 2세 미만, 눕혀서 측정
- **선키 (Standing height)**: 2세 이상, 서서 측정
- 두 측정값은 약 **0.7cm 차이**가 있음
- 신장별체중 파일 사용 시 측정 방식에 맞는 파일 선택 필요
